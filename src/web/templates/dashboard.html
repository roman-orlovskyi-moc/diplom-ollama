{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h1><i class="bi bi-graph-up"></i> Metrics Dashboard</h1>
<p class="lead">Real-time statistics and test results.</p>

<div class="row mt-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-clipboard-data display-4 text-primary"></i>
                <h3 class="mt-2">{{ db_stats.total_tests }}</h3>
                <p class="text-muted">Total Tests</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-x-circle display-4 text-danger"></i>
                <h3 class="mt-2">{{ db_stats.successful_attacks }}</h3>
                <p class="text-muted">Successful Attacks</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-bug display-4 text-warning"></i>
                <h3 class="mt-2">{{ attack_stats.total_attacks }}</h3>
                <p class="text-muted">Attack Patterns</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="bi bi-folder display-4 text-info"></i>
                <h3 class="mt-2">{{ attack_stats.categories|length }}</h3>
                <p class="text-muted">Categories</p>
            </div>
        </div>
    </div>
</div>

{% if db_stats.total_tests > 0 %}
<div class="row mt-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Results by Defense</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Defense</th>
                            <th>Tests</th>
                            <th>Success Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for defense, stats in db_stats.by_defense.items() %}
                        <tr>
                            <td>{{ defense }}</td>
                            <td>{{ stats.total }}</td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-danger" style="width: {{ stats.success_rate * 100 }}%">
                                        {{ "%.1f"|format(stats.success_rate * 100) }}%
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">Results by Category</h5>
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Tests</th>
                            <th>Success Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, stats in db_stats.by_category.items() %}
                        <tr>
                            <td>{{ category|replace('_', ' ')|title }}</td>
                            <td>{{ stats.total }}</td>
                            <td>
                                <div class="progress" style="height: 20px;">
                                    <div class="progress-bar bg-warning" style="width: {{ stats.success_rate * 100 }}%">
                                        {{ "%.1f"|format(stats.success_rate * 100) }}%
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row mt-4">
    <div class="col-md-12">
        <div class="alert alert-info">
            <i class="bi bi-info-circle"></i> No test results yet. Run some tests in the <a href="/demo">Demo</a> page to see statistics here.
        </div>
    </div>
</div>
{% endif %}
{% endblock %}